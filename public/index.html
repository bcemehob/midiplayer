<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MIDI Player Frontend</title>
</head>
<body>
  <h1>MIDI Player</h1>
  
  <input type="file" id="midiFile" accept=".mid,.midi" />
  <button id="uploadBtn">Upload</button>
  <button id="startBtn">Start</button>
  <button id="stopBtn">Stop</button>

  <h3>Playback Events:</h3>
  <pre id="events"></pre>

  <script>
    const uploadBtn = document.getElementById('uploadBtn')
    const startBtn = document.getElementById('startBtn')
    const stopBtn = document.getElementById('stopBtn')
    const eventsBox = document.getElementById('events')

    let fileName = null

    uploadBtn.onclick = async () => {
      const fileInput = document.getElementById('midiFile')
      if (!fileInput.files.length) return alert("Select a MIDI file first!")
      const formData = new FormData()
      formData.append("midi", fileInput.files[0])

      const res = await fetch("/upload", { method: "POST", body: formData })
      const data = await res.json()
      fileName = data.file
      eventsBox.textContent = `Uploaded: ${fileName}\n`

      // Start listening to SSE
      const evtSource = new EventSource("/events")
      evtSource.onmessage = (e) => {
        eventsBox.textContent += e.data + "\n"
      };
    };

    startBtn.onclick = async () => {
      if (!fileName) return alert("Upload a file first!")
      await fetch("/start?file=" + encodeURIComponent(fileName))
    };

    stopBtn.onclick = async () => {
      await fetch("/stop")
    };
  </script>
</body>
</html>